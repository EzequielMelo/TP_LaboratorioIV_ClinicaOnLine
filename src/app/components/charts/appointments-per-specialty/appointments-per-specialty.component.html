<div class="appointments-specialty-container">
  <!-- Header del componente -->
  <div class="component-header">
    <div class="header-info">
      <h3>🏥 Turnos por Especialidad</h3>
      <p class="description">
        Cantidad de turnos agrupados por especialidad médica
      </p>
    </div>

    <div class="header-actions">
      <button class="btn btn-refresh" (click)="refresh()" [disabled]="loading">
        <span *ngIf="!loading">🔄</span>
        <span *ngIf="loading" class="spinner">⏳</span>
        {{ loading ? "Cargando..." : "Actualizar" }}
      </button>

      <button
        class="btn btn-export"
        (click)="exportToCSV()"
        [disabled]="loading || specialityCounts.length === 0"
      >
        📊 Exportar CSV
      </button>
    </div>
  </div>

  <!-- Estadísticas generales -->
  <div class="stats-section" *ngIf="!loading && !error">
    <div class="stats-cards">
      <div class="stat-card primary">
        <div class="stat-icon">📋</div>
        <div class="stat-content">
          <div class="stat-number">{{ totalAppointments }}</div>
          <div class="stat-label">Total Turnos</div>
        </div>
      </div>

      <div class="stat-card success">
        <div class="stat-icon">🏥</div>
        <div class="stat-content">
          <div class="stat-number">{{ totalSpecialities }}</div>
          <div class="stat-label">Especialidades</div>
        </div>
      </div>

      <div class="stat-card info">
        <div class="stat-icon">🏆</div>
        <div class="stat-content">
          <div class="stat-number">{{ topSpeciality?.cantidad || 0 }}</div>
          <div class="stat-label">
            {{ topSpeciality?.especialidad || "N/A" }}
          </div>
          <div class="stat-sublabel">Más Popular</div>
        </div>
      </div>

      <div class="stat-card warning">
        <div class="stat-icon">📊</div>
        <div class="stat-content">
          <div class="stat-number">{{ averagePerSpeciality }}</div>
          <div class="stat-label">Promedio por Especialidad</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Estados de carga y error -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner">⏳</div>
    <p>Cargando datos de especialidades...</p>
  </div>

  <div *ngIf="error && !loading" class="error-state">
    <div class="error-icon">❌</div>
    <p>{{ error }}</p>
    <button class="btn btn-retry" (click)="refresh()">🔄 Reintentar</button>
  </div>

  <!-- Contenido principal - Gráficos -->
  <div
    *ngIf="!loading && !error && specialityCounts.length > 0"
    class="charts-section"
  >
    <!-- Gráficos en fila -->
    <div class="charts-row">
      <!-- Gráfico de Torta -->
      <div class="chart-card half">
        <div class="chart-wrapper">
          <div
            echarts
            [options]="pieChartOption"
            [loading]="loading"
            class="chart-pie"
          ></div>
        </div>
      </div>

      <!-- Gráfico de Barras -->
      <div class="chart-card half">
        <div class="chart-wrapper">
          <div
            echarts
            [options]="barChartOption"
            [loading]="loading"
            class="chart-bar"
          ></div>
        </div>
      </div>
    </div>

    <!-- Tabla detallada -->
    <div class="table-section">
      <div class="table-header">
        <h4>📋 Detalle por Especialidad</h4>
        <span class="table-count"
          >{{ specialityCounts.length }} especialidades encontradas</span
        >
      </div>

      <div class="table-wrapper">
        <table class="specialty-table">
          <thead>
            <tr>
              <th>🏥 Especialidad</th>
              <th>📊 Cantidad</th>
              <th>📈 Porcentaje</th>
              <th>🎯 Estado</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let specialty of specialityCounts;
                let i = index;
                trackBy: trackBySpecialty
              "
              class="specialty-row"
            >
              <td class="specialty-name">
                <div class="specialty-info">
                  <span>{{ specialty.especialidad }}</span>
                </div>
              </td>
              <td class="specialty-count">
                <strong>{{ specialty.cantidad }}</strong> turnos
              </td>
              <td class="specialty-percentage">
                <div class="percentage-bar">
                  <span class="percentage-text"
                    >{{ specialty.porcentaje }}%</span
                  >
                </div>
              </td>
              <td class="specialty-status">
                <span
                  class="status-badge"
                  [class]="getStatusClass(specialty.cantidad)"
                >
                  {{ getStatusLabel(specialty.cantidad) }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Mensaje si no hay datos -->
  <div
    *ngIf="!loading && !error && specialityCounts.length === 0"
    class="no-data"
  >
    <div class="no-data-icon">📭</div>
    <h4>No hay datos de turnos</h4>
    <p>No se encontraron turnos con especialidades en la base de datos.</p>
    <button class="btn btn-refresh" (click)="refresh()">
      🔄 Intentar de nuevo
    </button>
  </div>
</div>
